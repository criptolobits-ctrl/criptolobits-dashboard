<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CriptoLobits Dashboard - Secci√≥n Trading</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.1.1/dist/chartjs-chart-financial.min.js"></script>
    
    <style>
        /* ESTILOS BASE DEL DASHBOARD (COPIADOS DE LA PLANTILLA ORIGINAL) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f0f23;
            color: white;
            padding-bottom: 50px; /* Espacio extra al final */
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        .card {
            background: rgba(26, 26, 46, 0.7);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0, 255, 136, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            transition: all 0.3s ease;
        }
        .card:hover {
            border-color: #00ff88;
        }
        .section-title {
            font-size: 28px;
            margin-bottom: 30px;
            color: #fff;
            background: linear-gradient(45deg, #00ff88, #0099ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: left;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        .btn-primary {
            background: linear-gradient(45deg, #00ff88, #00cc70);
            color: #0f0f23;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
        }

        /* --- ESTILOS ESPEC√çFICOS PARA LA SECCI√ìN DE TRADING --- */
        .trading-grid {
            display: grid;
            grid-template-columns: 1fr 400px; /* Columna principal para la gr√°fica, columna lateral para m√≥dulos */
            gap: 25px;
        }

        .main-chart-container {
            grid-column: 1 / 2;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .sidebar-container {
            grid-column: 2 / 3;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .chart-card {
            display: flex;
            flex-direction: column;
            height: 650px; /* Altura fija para la gr√°fica principal */
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 22px;
            font-weight: bold;
        }

        .timeframe-controls button {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
            border: 1px solid transparent;
            margin-left: 5px;
        }
        .timeframe-controls button:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        .timeframe-controls button.active {
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
            border-color: #00ff88;
        }

        .chart-wrapper {
            flex-grow: 1;
            position: relative;
        }
        .chart-wrapper canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .indicator-card h4, .backtest-card h4, .risk-card h4, .signals-card h4 {
            color: #0099ff;
            margin-bottom: 20px;
            font-size: 18px;
            border-bottom: 1px solid rgba(0, 153, 255, 0.2);
            padding-bottom: 10px;
        }

        .indicator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .indicator-item {
            background: rgba(15, 15, 35, 0.6);
            padding: 15px;
            border-radius: 10px;
        }

        .indicator-item .value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .indicator-item .label {
            font-size: 14px;
            color: #aaa;
        }
        
        .indicator-item .bullish { color: #00ff88; }
        .indicator-item .bearish { color: #ff4444; }
        .indicator-item .neutral { color: #aaa; }
        
        .indicator-chart-wrapper {
            height: 80px;
            margin-top: 15px;
        }

        .backtest-form .form-group {
            margin-bottom: 15px;
        }
        .backtest-form label {
            display: block;
            color: #ccc;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .backtest-form input, .backtest-form select {
            width: 100%;
            padding: 10px;
            background: rgba(15, 15, 35, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: white;
        }
        
        .backtest-results { margin-top: 20px; }
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .results-grid .metric {
            background: rgba(15, 15, 35, 0.6);
            padding: 10px;
            border-radius: 8px;
        }
        .results-grid .metric-label { font-size: 12px; color: #aaa; }
        .results-grid .metric-value { font-size: 18px; font-weight: bold; }
        
        .equity-curve-wrapper { height: 120px; margin-top: 20px; }

        .risk-calculator { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .risk-form, .risk-results { display: flex; flex-direction: column; }
        #portfolio-allocation-chart { max-height: 120px; margin-top: 15px; }

        .signals-feed {
            max-height: 200px;
            overflow-y: auto;
            padding-right: 10px;
        }
        /* Custom scrollbar */
        .signals-feed::-webkit-scrollbar { width: 5px; }
        .signals-feed::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); }
        .signals-feed::-webkit-scrollbar-thumb { background: #00ff88; }

        .signal-item {
            padding: 12px;
            background: rgba(15, 15, 35, 0.7);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .signal-item.bullish { border-left-color: #00ff88; }
        .signal-item.bearish { border-left-color: #ff4444; }
        
        .signal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .signal-header .type { font-weight: bold; }
        .signal-header .time { font-size: 12px; color: #aaa; }
        .signal-content { font-size: 14px; }
        
        /* RESPONSIVE DESIGN */
        @media (max-width: 1200px) {
            .trading-grid {
                grid-template-columns: 1fr; /* Stack columns on smaller screens */
            }
            .main-chart-container, .sidebar-container {
                grid-column: 1 / -1;
            }
            .chart-card {
                height: 500px;
            }
        }
        @media (max-width: 768px) {
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .indicator-grid, .risk-calculator {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div id="trading" class="section">
        <h2 class="section-title">üíπ Suite de Trading Profesional</h2>
        
        <div class="trading-grid">

            <div class="main-chart-container">
                <div class="card chart-card">
                    <div class="chart-header">
                        <div class="chart-title">BTC / USDT</div>
                        <div class="timeframe-controls">
                            <button class="btn btn-sm active">1H</button>
                            <button class="btn btn-sm">4H</button>
                            <button class="btn btn-sm">1D</button>
                            <button class="btn btn-sm">1W</button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="mainTradingChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="sidebar-container">
                
                <div class="card indicator-card">
                    <h4>üìä Indicadores T√©cnicos</h4>
                    <div class="indicator-grid">
                        <div class="indicator-item">
                            <div class="label">RSI (14)</div>
                            <div class="value" id="rsi-value">--</div>
                            <div class="indicator-chart-wrapper"><canvas id="rsiChart"></canvas></div>
                        </div>
                        <div class="indicator-item">
                            <div class="label">MACD (12, 26, 9)</div>
                            <div class="value" id="macd-value">--</div>
                            <div class="indicator-chart-wrapper"><canvas id="macdChart"></canvas></div>
                        </div>
                         <div class="indicator-item">
                            <div class="label">Moving Average (50)</div>
                            <div class="value neutral" id="ma50-value">--</div>
                        </div>
                        <div class="indicator-item">
                            <div class="label">Bollinger Bands¬Æ</div>
                            <div class="value neutral" id="bb-value">--</div>
                        </div>
                    </div>
                </div>

                <div class="card backtest-card">
                    <h4>‚öôÔ∏è Sistema de Backtesting</h4>
                    <div class="backtest-form">
                        <div class="form-group">
                            <label for="strategy">Estrategia</label>
                            <select id="strategy">
                                <option value="ma_crossover">Cruce de Medias M√≥viles</option>
                                <option value="rsi_momentum">Momentum con RSI</option>
                            </select>
                        </div>
                        <div class="form-group">
                             <label for="capital">Capital Inicial (USDT)</label>
                             <input type="number" id="capital" value="10000">
                        </div>
                        <button class="btn btn-primary" id="runBacktestBtn">Ejecutar Backtest</button>
                    </div>
                    <div class="backtest-results">
                        <div class="results-grid">
                            <div class="metric"><span class="metric-label">Rentabilidad Final</span><span class="metric-value" id="backtest-return">--</span></div>
                            <div class="metric"><span class="metric-label">Sharpe Ratio</span><span class="metric-value" id="backtest-sharpe">--</span></div>
                            <div class="metric"><span class="metric-label">Max Drawdown</span><span class="metric-value" id="backtest-drawdown">--</span></div>
                            <div class="metric"><span class="metric-label">Win Rate</span><span class="metric-value" id="backtest-winrate">--</span></div>
                        </div>
                        <div class="equity-curve-wrapper"><canvas id="equityCurveChart"></canvas></div>
                    </div>
                </div>
                
                <div class="card risk-card">
                    <h4>‚öñÔ∏è Gesti√≥n de Riesgo</h4>
                    <div class="risk-calculator">
                        <div class="risk-form">
                            <div class="form-group">
                                <label>Capital Total (USDT)</label>
                                <input type="number" id="risk-capital" value="10000">
                            </div>
                            <div class="form-group">
                                <label>Riesgo por Operaci√≥n (%)</label>
                                <input type="number" id="risk-percent" value="1">
                            </div>
                             <div class="form-group">
                                <label>Precio de Entrada</label>
                                <input type="number" id="risk-entry" value="68500">
                            </div>
                            <div class="form-group">
                                <label>Stop Loss</label>
                                <input type="number" id="risk-sl" value="67800">
                            </div>
                        </div>
                        <div class="risk-results">
                             <div class="metric"><span class="metric-label">P√©rdida M√°xima</span><span class="metric-value" id="risk-max-loss">--</span></div>
                             <div class="metric"><span class="metric-label">Tama√±o de Posici√≥n</span><span class="metric-value" id="risk-position-size">--</span></div>
                             <div id="portfolio-allocation-chart">
                                <canvas id="riskDonutChart"></canvas>
                             </div>
                        </div>
                    </div>
                </div>

                <div class="card signals-card">
                    <h4>‚ö° Se√±ales de Trading (Simuladas)</h4>
                    <div class="signals-feed" id="signals-feed">
                        </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    
    // --- CONFIGURACI√ìN Y COLORES ---
    const BULL_COLOR = '#00ff88';
    const BEAR_COLOR = '#ff4444';
    const NEUTRAL_COLOR = '#0099ff';
    const GRID_COLOR = 'rgba(255, 255, 255, 0.1)';

    // --- GENERACI√ìN DE DATOS SIMULADOS ---
    function generateCandlestickData(days) {
        let date = new Date();
        date.setDate(date.getDate() - days);
        let price = 65000;
        const data = [];
        for (let i = 0; i < days; i++) {
            const open = price + (Math.random() - 0.5) * 500;
            const close = open + (Math.random() - 0.5) * 1000;
            const high = Math.max(open, close) + Math.random() * 500;
            const low = Math.min(open, close) - Math.random() * 500;
            const volume = Math.random() * 1000 + 500;
            data.push({
                x: date.getTime(),
                o: open,
                h: high,
                l: low,
                c: close,
                v: volume
            });
            price = close;
            date.setDate(date.getDate() + 1);
        }
        return data;
    }

    const rawData = generateCandlestickData(365); // Generar 1 a√±o de datos para filtrar por timeframe

    // --- C√ÅLCULO DE INDICADORES ---
    const calculateMA = (data, period) => {
        const result = [];
        for (let i = period - 1; i < data.length; i++) {
            const sum = data.slice(i - period + 1, i + 1).reduce((acc, val) => acc + val.c, 0);
            result.push({ x: data[i].x, y: sum / period });
        }
        return result;
    };

    const calculateBollingerBands = (data, period, stdDev) => {
        const ma = calculateMA(data, period).map(d => d.y);
        const upper = [];
        const lower = [];
        for (let i = period - 1; i < data.length; i++) {
            const slice = data.slice(i - period + 1, i + 1).map(d => d.c);
            const mean = ma[i - period + 1];
            const variance = slice.reduce((acc, val) => acc + (val - mean) ** 2, 0) / period;
            const sd = Math.sqrt(variance);
            upper.push({ x: data[i].x, y: mean + stdDev * sd });
            lower.push({ x: data[i].x, y: mean - stdDev * sd });
        }
        return { upper, lower };
    };
    
    const calculateRSI = (data, period = 14) => {
        const rsiData = [];
        let avgGain = 0, avgLoss = 0;
        for (let i = 1; i < data.length; i++) {
            const change = data[i].c - data[i-1].c;
            const gain = change > 0 ? change : 0;
            const loss = change < 0 ? -change : 0;

            if (i < period) {
                avgGain += gain;
                avgLoss += loss;
                continue;
            }
            if (i === period) {
                avgGain /= period;
                avgLoss /= period;
            } else {
                avgGain = (avgGain * (period - 1) + gain) / period;
                avgLoss = (avgLoss * (period - 1) + loss) / period;
            }
            const rs = avgGain / avgLoss;
            const rsi = 100 - (100 / (1 + rs));
            rsiData.push({x: data[i].x, y: rsi});
        }
        return rsiData;
    };

    const calculateEMA = (data, period) => {
        const k = 2 / (period + 1);
        const emaData = [];
        let ema = data[0].c;
        emaData.push({x: data[0].x, y: ema});
        for(let i=1; i < data.length; i++){
            ema = data[i].c * k + ema * (1-k);
            emaData.push({x: data[i].x, y: ema});
        }
        return emaData;
    }

    const calculateMACD = (data, short=12, long=26, signal=9) => {
        const emaLong = calculateEMA(data, long);
        const emaShort = calculateEMA(data, short);
        const macdLine = emaShort.map((val, i) => ({x: val.x, y: val.y - emaLong[i].y}));
        const signalLine = calculateEMA(macdLine.map(d => ({c: d.y, x:d.x})), signal);
        const histogram = macdLine.map((val, i) => ({x: val.x, y: val.y - signalLine[i].y}));
        return {macdLine, signalLine, histogram};
    }

    const tradingData = rawData.slice(-90); // Usar los √∫ltimos 90 d√≠as para las gr√°ficas
    const ma50 = calculateMA(tradingData, 50);
    const bollingerBands = calculateBollingerBands(tradingData, 20, 2);
    const rsiData = calculateRSI(tradingData);
    const macdData = calculateMACD(tradingData);

    // --- GR√ÅFICA PRINCIPAL ---
    const mainChartCtx = document.getElementById('mainTradingChart').getContext('2d');
    const mainTradingChart = new Chart(mainChartCtx, {
        type: 'candlestick',
        data: {
            datasets: [{
                label: 'BTC/USDT',
                data: tradingData,
                borderColor: NEUTRAL_COLOR,
                color: {
                    up: BULL_COLOR,
                    down: BEAR_COLOR,
                    unchanged: '#999',
                }
            }, {
                type: 'line',
                label: 'MA 50',
                data: ma50,
                borderColor: '#ffc107',
                borderWidth: 1.5,
                pointRadius: 0
            }, {
                type: 'line',
                label: 'BB Upper',
                data: bollingerBands.upper,
                borderColor: 'rgba(0,153,255, 0.5)',
                borderWidth: 1,
                pointRadius: 0,
                fill: '+1'
            }, {
                type: 'line',
                label: 'BB Lower',
                data: bollingerBands.lower,
                borderColor: 'rgba(0,153,255, 0.5)',
                borderWidth: 1,
                pointRadius: 0,
                backgroundColor: 'rgba(0,153,255, 0.1)',
                fill: false
            }, {
                type: 'bar',
                label: 'Volume',
                data: tradingData.map(d => ({x: d.x, y: d.v})),
                backgroundColor: (ctx) => (ctx.raw.c > ctx.raw.o ? 'rgba(0, 255, 136, 0.5)' : 'rgba(255, 68, 68, 0.5)'),
                yAxisID: 'y_volume'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    type: 'time',
                    time: { unit: 'day' },
                    grid: { color: GRID_COLOR },
                    ticks: { color: '#ccc' }
                },
                y: {
                    grid: { color: GRID_COLOR },
                    ticks: { color: '#ccc' }
                },
                y_volume: {
                    position: 'right',
                    display: false,
                    max: Math.max(...tradingData.map(d => d.v)) * 4 // Push volume bars down
                }
            },
            plugins: {
                legend: { display: false },
                tooltip: { mode: 'index', intersect: false },
            }
        }
    });
    
    // --- GR√ÅFICAS DE INDICADORES ---
    const createIndicatorChart = (ctx, data, color, zones = []) => new Chart(ctx, {
        type: 'line',
        data: { datasets: [{ data, borderColor: color, borderWidth: 2, pointRadius: 0, tension: 0.4 }] },
        options: {
            responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { display: false } },
            plugins: { legend: { display: false }, annotation: { annotations: zones } }
        }
    });

    const rsiCtx = document.getElementById('rsiChart').getContext('2d');
    const rsiChart = createIndicatorChart(rsiCtx, rsiData, NEUTRAL_COLOR);
    
    const macdCtx = document.getElementById('macdChart').getContext('2d');
    const macdChart = new Chart(macdCtx, {
        type: 'bar',
        data: {
            datasets: [{
                label: 'Histogram',
                data: macdData.histogram,
                backgroundColor: macdData.histogram.map(d => d.y > 0 ? 'rgba(0, 255, 136, 0.5)' : 'rgba(255, 68, 68, 0.5)'),
            }, {
                type: 'line',
                label: 'MACD',
                data: macdData.macdLine,
                borderColor: NEUTRAL_COLOR,
                borderWidth: 1.5,
                pointRadius: 0
            }, {
                type: 'line',
                label: 'Signal',
                data: macdData.signalLine,
                borderColor: '#ffc107',
                borderWidth: 1.5,
                pointRadius: 0
            }]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { display: false } }, plugins: { legend: { display: false } } }
    });
    
    // --- ACTUALIZAR VALORES DE INDICADORES ---
    const lastRSI = rsiData[rsiData.length-1];
    document.getElementById('rsi-value').textContent = lastRSI.y.toFixed(2);
    document.getElementById('rsi-value').className = `value ${lastRSI.y > 70 ? 'bearish' : lastRSI.y < 30 ? 'bullish' : 'neutral'}`;

    const lastMACD = macdData.histogram[macdData.histogram.length - 1];
    document.getElementById('macd-value').textContent = lastMACD.y.toFixed(2);
    document.getElementById('macd-value').className = `value ${lastMACD.y > 0 ? 'bullish' : 'bearish'}`;

    document.getElementById('ma50-value').textContent = ma50[ma50.length - 1].y.toFixed(2);
    const lastBB = {upper: bollingerBands.upper.slice(-1)[0].y, lower: bollingerBands.lower.slice(-1)[0].y};
    document.getElementById('bb-value').textContent = `${lastBB.lower.toFixed(0)} - ${lastBB.upper.toFixed(0)}`;


    // --- L√ìGICA DE BACKTESTING ---
    const equityCurveCtx = document.getElementById('equityCurveChart').getContext('2d');
    const equityCurveChart = new Chart(equityCurveCtx, {
        type: 'line',
        data: { datasets: [{ label: 'Capital', data: [], borderColor: BULL_COLOR, borderWidth: 2, pointRadius: 0 }] },
        options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'time', display: false }, y: { display: false } }, plugins: { legend: { display: false } } }
    });

    document.getElementById('runBacktestBtn').addEventListener('click', () => {
        const initialCapital = parseFloat(document.getElementById('capital').value);
        let capital = initialCapital;
        const equity = [{x: tradingData[0].x, y: capital}];
        let trades = 0, wins = 0;
        let peak = capital;
        let maxDrawdown = 0;
        
        // Simulaci√≥n simple de cruce de MA
        const shortMA = calculateMA(tradingData, 10);
        const longMA = calculateMA(tradingData, 30);
        let inPosition = false;

        for (let i = 1; i < longMA.length; i++) {
            const prevShort = shortMA[i-1].y;
            const prevLong = longMA[i-1].y;
            const currShort = shortMA[i].y;
            const currLong = longMA[i].y;

            if (prevShort <= prevLong && currShort > currLong && !inPosition) { // Buy Signal
                inPosition = true;
            } else if (prevShort >= prevLong && currShort < currLong && inPosition) { // Sell Signal
                const entryPrice = equity[equity.length - 1].y;
                const exitPrice = capital * (tradingData[i + 29].c / tradingData[equity.length + 29].c);
                if(exitPrice > entryPrice) wins++;
                capital = exitPrice;
                trades++;
                inPosition = false;
            }
            equity.push({ x: longMA[i].x, y: capital });
            if (capital > peak) peak = capital;
            const drawdown = (peak - capital) / peak;
            if (drawdown > maxDrawdown) maxDrawdown = drawdown;
        }

        const finalReturn = ((capital - initialCapital) / initialCapital) * 100;
        document.getElementById('backtest-return').textContent = `${finalReturn.toFixed(2)}%`;
        document.getElementById('backtest-sharpe').textContent = (finalReturn / (maxDrawdown * 100) * 1.5).toFixed(2); // Sharpe simulado
        document.getElementById('backtest-drawdown').textContent = `-${(maxDrawdown * 100).toFixed(2)}%`;
        document.getElementById('backtest-winrate').textContent = `${((wins / trades) * 100 || 0).toFixed(2)}%`;
        
        equityCurveChart.data.datasets[0].data = equity;
        equityCurveChart.update();
    });

    // --- L√ìGICA DE CALCULADORA DE RIESGO ---
    const riskDonutCtx = document.getElementById('riskDonutChart').getContext('2d');
    const riskDonutChart = new Chart(riskDonutCtx, {
        type: 'doughnut',
        data: {
            labels: ['Capital en Riesgo', 'Capital Seguro'],
            datasets: [{ data: [1, 99], backgroundColor: [BEAR_COLOR, BULL_COLOR], borderColor: '#0f0f23' }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
    });
    
    const riskInputs = ['risk-capital', 'risk-percent', 'risk-entry', 'risk-sl'];
    riskInputs.forEach(id => document.getElementById(id).addEventListener('input', updateRiskCalc));
    
    function updateRiskCalc() {
        const capital = parseFloat(document.getElementById('risk-capital').value);
        const riskPercent = parseFloat(document.getElementById('risk-percent').value);
        const entry = parseFloat(document.getElementById('risk-entry').value);
        const sl = parseFloat(document.getElementById('risk-sl').value);

        if(!capital || !riskPercent || !entry || !sl || entry <= sl) return;

        const maxLoss = capital * (riskPercent / 100);
        const lossPerShare = entry - sl;
        const positionSize = maxLoss / lossPerShare;
        
        document.getElementById('risk-max-loss').textContent = `$${maxLoss.toFixed(2)}`;
        document.getElementById('risk-position-size').textContent = `${positionSize.toFixed(4)} BTC`;

        riskDonutChart.data.datasets[0].data = [maxLoss, capital - maxLoss];
        riskDonutChart.update();
    }
    updateRiskCalc();

    // --- SIMULACI√ìN DE SE√ëALES EN VIVO ---
    const signalsFeed = document.getElementById('signals-feed');
    setInterval(() => {
        const isBullish = Math.random() > 0.5;
        const signal = document.createElement('div');
        signal.className = `signal-item ${isBullish ? 'bullish' : 'bearish'}`;
        const now = new Date();
        signal.innerHTML = `
            <div class="signal-header">
                <span class="type">${isBullish ? 'Compra Fuerte (Bullish Engulfing)' : 'Venta (Cruce MA)'}</span>
                <span class="time">${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}</span>
            </div>
            <div class="signal-content">
                BTC/USDT en timeframe de 1H. ${isBullish ? 'Entrada sugerida: $68,750' : 'Revisar soporte en $68,200'}.
            </div>
        `;
        signalsFeed.prepend(signal);
        if (signalsFeed.children.length > 10) {
            signalsFeed.lastChild.remove();
        }
    }, 5000);
});
</script>

</body>
</html>
